<?xml version="1.0"?>
<project name="OpenPetra-csharp">

<include buildfile="OpenPetra.default.targets.xml"/>

<if test="${file::exists(msbuildtask.file)}">
    <loadtasks assembly="${msbuildtask.file}" unless="${task::exists('msbuild')}"/>
</if>

<target name="MsBuildTarget">
    <msbuild project="${solution.file}" verbosity="Minimal">
        <property name="Configuration" value="${Configuration}"/>
    </msbuild>
</target>

<target name="uncrustify" depends="indent" 
        description="indent the code, so it adheres the formatting guidelines" />

<target name="indent" depends="" description="indent the code, so it adheres the formatting guidelines. Use nant -D:files=filename indent">
  <if test="${not property::exists('files')}">
  <!-- set all files as default -->
    <property name="files" value="" />
    <foreach item="File" property="filename" trim="Both">
      <in><items><include name="**.cs" /></items></in>
      <do><property name="files" value="${files},&quot;${filename}&quot;" /></do>
    </foreach>
  </if>
  <property name="files" value="${string::trim(files)}" />
  <echo level="Debug">files='${files}'</echo>
  <foreach item="String" in="${files}" delim="," trim="Both" property="filename"><do>
    <if test="${0!=string::get-length(filename)}">
      <if test="${not OP::IsAutoGeneratedFile(filename)}">
        <echo message="Indent ${filename}"/>
        <exec program="${external.Uncrustify}" workingdir="${project::get-base-directory()}" resultproperty="rc"> 
          <arg value="-q" />
          <arg value="-c" />
          <arg value="${dir.incdir.cfg}/uncrustify-petra.cfg" />
          <arg value="--no-backup" />
          <arg value="${filename}" />
        </exec>
      </if>
    </if>
  </do></foreach>
</target>

<if test="${not target::exists('custclean')}">
  <include buildfile="OpenPetra.target-custclean.xml"/>
</if>

<target name="clean" depends="custclean"/>

<if test="${not target::exists('custdepend')}">
  <include buildfile="OpenPetra.target-custdepend.xml"/>
</if>

<target name="compile" depends="custdepend"/>

</project>
